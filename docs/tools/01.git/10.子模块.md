---
sidebar: false
permalink: git/submodule
date: 2019-10-01
---

## 添加子模块
将一个已存在的目标 Git 仓库添加为当前仓库的子模块。  
通过命令 `git submodule add [<options>] <repository_url> [<path>]` 实现, eg:  
```bash
git submodule add https://github.com/chaconinc/DbConnector
```
添加的子模块默认是放在当前项目的根目录，也可以指定最后一个`path`参数放在其它路径。  
添加成功后，会生成一个新的文件 `.gitmodules`, 记录子模块信息。

## 克隆含有子模块的项目
`git clone`命令克隆带有子模块的项目，其子模块目录会**默认为空**  

以下两种方式可以完成子模块代码的拉取：
1. clone 完成后继续执行两条命令
    - `git submodule init`, 初始化配置文件
    - `git submodule update`, 拉取数据到合适的目录
2. 给 git clone 添加 `--recursive` 参数

## 更新子模块
使用子模块最简单的模型就是遵循"单向数据流"的做法，只在子模块的原始项目做更新，在当前项目仅仅是引用。 
这样的话当子模块有更新后，只需要到子模块对应目录下执行 `git pull`命令即可。

也可以直接在当前项目执行命令 `git submodule update --remote`来更新子模块。  
该命令默认更新所有子模块。也可以在后面添加具体的子模块名字，只更新局部。eg: 
```bash
git submodule update --remote DbConnector
```

### 在主项目更新子模块
如果就是要在当前项目改动子模块，该如何保存并推送该更新呢？

提交两次就可以
- 进入到子模块目录，修改，提交，推送
- 在当前项目根目录，提交，推送

总之，把子模块当作一个独立代码库处理即可。


## 删除子模块
- 删除子模块目录及源码
    - 手动删除
        - 删除子模块目录
        - 删除项目目录下 `.gitmodules`文件中子模块相关条目
        - 删除配置项 `.git/config`中子模块相关条目
    - 或者执行命令 `git submodule deinit [<MOD_NAME>]`, 即逆向初始化
- 删除模块下的子模块目录 `.git/module/*`，
    - 每个子模块对应一个目录，注意只删除对应的子模块目录即可
    - 通过命令的方式 `git rm --cached [<MOD_NAME>]`
- 提交修改