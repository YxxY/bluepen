(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{771:function(s,t,n){"use strict";n.r(t);var a=n(51),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"来源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#来源"}},[s._v("->")]),s._v(" 来源")]),s._v(" "),n("p",[s._v("使用变量在流水线脚本中是非常方便且强大的功能，变量的来源主要有三个部分")]),s._v(" "),n("ul",[n("li",[s._v("任务运行所在的节点的系统环境变量(增量需要重新建立连接生效)")]),s._v(" "),n("li",[s._v("Jenkins 及安装的插件提供的全局变量\n"),n("ul",[n("li",[n("code",[s._v("http://<jenkins-url>/pipeline-syntax/globals")]),s._v("对应的全局变量")]),s._v(" "),n("li",[n("code",[s._v("http://<jenkins-url>/systemInfo")]),s._v("(对应 "),n("code",[s._v("系统管理")]),s._v(" -> "),n("code",[s._v("系统信息")]),s._v(") "),n("code",[s._v("环境变量")]),s._v("的部分")])]),s._v(" "),n("div",{staticClass:"language-groovy line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" env "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" System"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getenv")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nprint env\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[n("code",[s._v("http://<jenkins-url>/env-vars.html")]),s._v(", 在任务执行脚本中可以使用的环境变量")]),s._v(" "),n("li",[s._v("在 "),n("code",[s._v("系统管理")]),s._v(" -> "),n("code",[s._v("系统配置")]),s._v(" -> "),n("code",[s._v("全局属性")]),s._v(" 中添加的环境变量")]),s._v(" "),n("li",[s._v("插件提供的环境变量参考插件使用说明")])])]),s._v(" "),n("li",[s._v("在流水线脚本中动态定义的环境变量")]),s._v(" "),n("li",[s._v("流水线定义的参数在运行过程中会被设定为同名环境变量")])]),s._v(" "),n("h3",{attrs:{id:"全局变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全局变量"}},[s._v("->")]),s._v(" 全局变量")]),s._v(" "),n("p",[s._v("参考 "),n("code",[s._v("http://<jenkins-url>/pipeline-syntax/globals")])]),s._v(" "),n("ul",[n("li",[s._v("pipeline")]),s._v(" "),n("li",[s._v("scm")]),s._v(" "),n("li",[s._v("currentBuild")]),s._v(" "),n("li",[s._v("env")]),s._v(" "),n("li",[s._v("params")]),s._v(" "),n("li",[s._v("docker")])]),s._v(" "),n("h2",{attrs:{id:"使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("->")]),s._v(" 使用")]),s._v(" "),n("ul",[n("li",[s._v("全局变量可在脚本中直接使用，如 "),n("code",[s._v("pipeline")]),s._v(", "),n("code",[s._v("scm")]),s._v(", "),n("code",[s._v("currentBuild")]),s._v("等")]),s._v(" "),n("li",[s._v("推荐统一使用 "),n("code",[s._v('"${env.ENV_NAME}"')]),s._v("的方式来引用全局环境变量 "),n("code",[s._v("env")]),s._v("里的内容"),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),n("p",[s._v("特别注意要使用双引号包裹环境变量")])])]),s._v(" "),n("li",[s._v("插件暴露的接口函数, 可直接使用\n"),n("ul",[n("li",[s._v("eg: "),n("code",[s._v("checkout")])])])]),s._v(" "),n("li",[s._v("有一些插件变量，是作为参数传递给插件暴露的函数接口，使用时不能使用双引号包裹\n"),n("ul",[n("li",[s._v("eg: 邮件插件，"),n("code",[s._v("emailext to: '$DEFAULT_RECIPIENTS'")])])])])]),s._v(" "),n("h3",{attrs:{id:"常用环境变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常用环境变量"}},[s._v("->")]),s._v(" 常用环境变量")]),s._v(" "),n("div",{staticClass:"language-groovy line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//env")]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"workspace: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WORKSPACE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"node: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NODE_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"job: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("JOB_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"curr-branch: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BRANCH_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//multi branch only")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// GIT_BRANCH = 'origin/' + sh(returnStdout: true, script: 'git rev-parse --abbrev-ref HEAD').trim()")]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"author: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CHANGE_AUTHOR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"build_id: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BUILD_NUMBER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"log: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BUILD_URL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('console"')]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"job url: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("JOB_URL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"display url: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RUN_DISPLAY_URL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//currentBuild")]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"result: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("currentBuild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//可读写，中间过程时可能为null")]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"result: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("currentBuild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//只读，not null")]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"duration: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("currentBuild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("durationString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"fullDisplayName: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("currentBuild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fullDisplayName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// folder1 » folder2 » foo #123")]),s._v("\necho "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"absoluteUrl: '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("currentBuild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("absoluteUrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\n\nscript"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Date start "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("currentBuild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("startTimeInMillis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    Date end "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("currentBuild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("startTimeInMillis "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" currentBuild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    String startDate "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"YYYY-MM-dd HH:mm:ss.Ms"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    String endDate "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" end"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"YYYY-MM-dd HH:mm:ss.Ms"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);